"""
{{ server.name }} - Auto-generated MCP Server
Version: {{ server.version }}
Generated by MCP Server Factory
"""

from fastmcp import FastMCP
{% if server.tools %}
{% for tool in server.tools %}
{% if tool.implementation.type == "python" and tool.implementation.handler %}
# Handler import for {{ tool.id }}
# from {{ tool.implementation.handler.split(":")[0] }} import {{ tool.implementation.handler.split(":")[1] }}
{% endif %}
{% endfor %}
{% endif %}

mcp = FastMCP("{{ server.name }}")

{% for tool in server.tools %}
@mcp.tool()
async def {{ tool.id }}({% for param in tool.parameters %}{{ param.name }}: {{ param.type | python_type }}{% if param.default is not none %} = {{ param.default | repr }}{% elif not param.required %} = None{% endif %}{% if not loop.last %}, {% endif %}{% endfor %}) -> dict:
    """
    {{ tool.description | wordwrap(72) | indent(4) }}
{% if tool.parameters %}

    Args:
{% for param in tool.parameters %}
        {{ param.name }}: {{ param.description }}
{% endfor %}
{% endif %}
    """
{% if tool.implementation.type == "python" and tool.implementation.handler %}
    # Python handler implementation
    # result = await {{ tool.implementation.handler.split(":")[1] }}({% for param in tool.parameters %}{{ param.name }}{% if not loop.last %}, {% endif %}{% endfor %})
    # return result

    # TODO: Implement handler at {{ tool.implementation.handler }}
    return {
        "status": "not_implemented",
        "tool": "{{ tool.id }}",
        "params": { {% for param in tool.parameters %}"{{ param.name }}": {{ param.name }}{% if not loop.last %}, {% endif %}{% endfor %} }
    }
{% elif tool.implementation.type == "http" %}
    import httpx
    async with httpx.AsyncClient() as client:
        response = await client.{{ tool.implementation.method | lower }}(
            "{{ tool.implementation.endpoint }}",
            {% if tool.parameters %}
            json={
                {% for param in tool.parameters %}
                "{{ param.name }}": {{ param.name }},
                {% endfor %}
            }
            {% endif %}
        )
        return response.json()
{% else %}
    # Placeholder implementation
    return {
        "status": "placeholder",
        "tool": "{{ tool.id }}",
        "message": "Implementation pending"
    }
{% endif %}

{% endfor %}

if __name__ == "__main__":
    print(f"[MCP] {{ server.name }} starting...")
    print(f"[MCP] Version: {{ server.version }}")
    print(f"[MCP] Tools: {{ server.tools | length }}")
    mcp.run()
